<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="DC's Blog"><title>一次责任链模式的使用 | Blog of DC</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">一次责任链模式的使用</h1><a id="logo" href="/.">Blog of DC</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">一次责任链模式的使用</h1><div class="post-meta">Aug 13, 2019<span> | </span><span class="category"><a href="/categories/设计模式/">设计模式</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#优化前"><span class="toc-text">优化前</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#优化后"><span class="toc-text">优化后</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Read-More"><span class="toc-text">Read More</span></a></li></ol></div></div><div class="post-content"><h2 id="优化前"><a href="#优化前" class="headerlink" title="优化前"></a>优化前</h2><p>原来的代码大概长这样：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">generate</span><span class="params">(String templateId, List&lt;String&gt; componentList, List&lt;Path&gt; uploadFileList ......)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.isNotBlank(templateId))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// service a process template...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isNotEmpty(componentList))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// service b process components...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isNotEmpty(uploadFileList))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// service c process upload files...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 省略其他处理逻辑</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (CollectionUtils.isNotEmpty(uploadFileList))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"some result A"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"some result B"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>总而言之，就是根据传入的参数，分别做某些事情。如果需求改变了，需要新增一些功能，则一方面增加方法入参，一方面在合适的代码位置加入新逻辑。<br>这样下去，方法变得越来越大，维护起来比较困难。因此决定优化以下。</p>
<p>经过考虑，我决定采用行为模式中的责任链模式来优化。以下是优化后的代码的大概样子。</p>
<h2 id="优化后"><a href="#优化后" class="headerlink" title="优化后"></a>优化后</h2><p>首先，定义一个上下文类，该类保存所有service需要处理的参数。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratorContext</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String templateId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String targetFileDirectory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Path&gt; localFilePaths = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; componentList = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Path&gt; uploadFileList = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String generateResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意，这里有一个问题，就是在一开始的代码中，如果有上传文件，返回结果A，否则返回结果B（一个比喻，实际代码可能不是这样）。在采用责任链模式改写的过程中，一直无法很好地获取个个责任者返回的值。因此，在上下文信息类中保存了generateResult，表示返回值，由各个责任者指定值。</p>
<p>接下来定义抽象的责任类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractGenerator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> AbstractGenerator nextGenerator;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AbstractGenerator <span class="title">setNextGenerator</span><span class="params">(AbstractGenerator nextGenerator)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nextGenerator = nextGenerator;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.nextGenerator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generateProject</span><span class="params">(GeneratorContext context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (needMyHelp(context))</span><br><span class="line">        &#123;</span><br><span class="line">            generateMyPart(context);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.nextGenerator != <span class="keyword">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">this</span>.nextGenerator.generateProject(context);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">generateMyPart</span><span class="params">(GeneratorContext context)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">needMyHelp</span><span class="params">(GeneratorContext context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然后是该各个具体的责任者，继承自该抽象类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(<span class="string">"baseGenerator"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseGenerator</span> <span class="keyword">extends</span> <span class="title">AbstractGenerator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">generateMyPart</span><span class="params">(GeneratorContext context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (Path localFile : context.getLocalFilePaths())</span><br><span class="line">            &#123;</span><br><span class="line">                Path targetFilePath = Paths.get(context.getTargetFileDirectory()).resolve(localFile.getFileName());</span><br><span class="line">                Files.copy(localFile, targetFilePath, StandardCopyOption.REPLACE_EXISTING);</span><br><span class="line">            &#125;</span><br><span class="line">            context.setGenerateResult(context.getTargetFileDirectory());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IOException e)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> GeneratorException(<span class="string">"base generator failed"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">needMyHelp</span><span class="params">(GeneratorContext context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(<span class="string">"componentGenerator"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ComponentGenerator</span> <span class="keyword">extends</span> <span class="title">AbstractGenerator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">generateMyPart</span><span class="params">(GeneratorContext context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        context.getComponentList().forEach(System.out::println);</span><br><span class="line">        context.setGenerateResult(context.getTargetFileDirectory());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">needMyHelp</span><span class="params">(GeneratorContext context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> CollectionUtils.isNotEmpty(context.getComponentList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>(<span class="string">"uploadGenerator"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadGenerator</span> <span class="keyword">extends</span> <span class="title">AbstractGenerator</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">generateMyPart</span><span class="params">(GeneratorContext context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        context.getUploadFileList().stream().map(Path::getFileName).forEach(System.out::println);</span><br><span class="line">        context.setGenerateResult(<span class="string">"handle upload file success"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">needMyHelp</span><span class="params">(GeneratorContext context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> CollectionUtils.isNotEmpty(context.getUploadFileList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在实际的开发中，还可以定义一个统一的异常，用于异常管理，在generateMyPart()方法中抛出，由上层捕获处理。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratorException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GeneratorException</span><span class="params">(<span class="keyword">final</span> String message)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GeneratorException</span><span class="params">(<span class="keyword">final</span> String message, <span class="keyword">final</span> Throwable cause)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message, cause);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来是构造责任链：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratorChainBuilder</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"baseGenerator"</span>)</span><br><span class="line">    <span class="keyword">private</span> AbstractGenerator baseGenerator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"componentGenerator"</span>)</span><br><span class="line">    <span class="keyword">private</span> AbstractGenerator componentGenerator;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span>(name = <span class="string">"uploadGenerator"</span>)</span><br><span class="line">    <span class="keyword">private</span> AbstractGenerator uploadGenerator;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> AbstractGenerator <span class="title">buildChain</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        baseGenerator.setNextGenerator(componentGenerator).setNextGenerator(uploadGenerator);</span><br><span class="line">        <span class="keyword">return</span> baseGenerator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来是service类，定义service类，封装责任链：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">GeneratorService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">generatorProject</span><span class="params">(GeneratorContext context)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratorServiceImpl</span> <span class="keyword">implements</span> <span class="title">GeneratorService</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GeneratorChainBuilder chainBuilder;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">generatorProject</span><span class="params">(GeneratorContext context)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        AbstractGenerator generatorChain = chainBuilder.buildChain();</span><br><span class="line">        generatorChain.generateProject(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后是使用者：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratorController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> GeneratorService generatorService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generate</span><span class="params">(@RequestParam ...)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 可以有一些预处理</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构造上下文</span></span><br><span class="line">        GeneratorContext context = <span class="keyword">new</span> GeneratorContext();</span><br><span class="line">        <span class="comment">// 根据入参，调用context的setter方法，设置上下文</span></span><br><span class="line">        context.setTemplateId(<span class="string">"1"</span>);</span><br><span class="line">        context.setLocalFilePaths(targetFilePaths);</span><br><span class="line">        context.setComponentList(componentList);</span><br><span class="line">        <span class="comment">// ..省略其他setter</span></span><br><span class="line"></span><br><span class="line">        generatorService.generatorProject(context);</span><br><span class="line">        <span class="keyword">return</span> context.getGenerateResult();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>此后，如果要加入新的功能，只需新建责任者，继承自AbstractGenerator类，实现相关方法，并在责任链构造器中在合适的顺序位置加入该新的责任者即可。</p>
<p>如果后面的责任者不需要进行处理，也就无法设置上下文信息中的result值，返回的result值只有需要处理的责任者才可设置，这样就解决了前面提到的返回值的问题。</p>
<p>这里其实还可以优化，就是每个责任者持有一个int类型的字段，表示其处理先后顺序，然后autowired注入到一个map或者list中，根据该字段进行排序，然后依次处理，其实这样也有点像之前写到的“工厂模式”了。</p>
<h2 id="Read-More"><a href="#Read-More" class="headerlink" title="Read More"></a>Read More</h2><p>[1]<a href="https://www.baeldung.com/chain-of-responsibility-pattern" target="_blank" rel="noopener">Chain of Responsibility Design Pattern in Java</a><br>[2]<a href="https://github.com/iluwatar/java-design-patterns/tree/master/chain" target="_blank" rel="noopener">责任链模式</a><br>[3]<a href="http://c.biancheng.net/view/1376.html" target="_blank" rel="noopener">模板方法模式</a><br>[4]<a href="https://blog.csdn.net/u010476994/article/details/80986435" target="_blank" rel="noopener">Spring注解——同一接口有多个实现类，如何注入？@Resource、@Autowired、@Qualifier</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://dcrunnn.github.io/2019/08/13/一次责任链模式的使用/" data-id="ck3tzacd7000pboub5j4id0ki" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACsElEQVR42u3awU7sMAwFUP7/p3nS2zId3WsnA4vTFSqlzTFSbNn5+oqv7//X053vH9fPJ5M3tG8+duHh4eGNlv50vf98G4I2WHlAH0OAh4eHd433frnJpvw+JSRbfxL0NsR4eHh4v8trke83930Rj4eHh/f3eU/UWSshL+U/mvfw8PDwYl7+mfct2mSJmybFxV4LHh4eXsxrC9y/8PPF+R4eHh7eYqo+Sxj7tsWsBH+xQjw8PLwLvHZByaArX0q+qyffql+Eh4eHt+DlY6e2jp0N0trmb9TMxcPDwzvEm5W/s9HU7JBBQn0MHB4eHt5HeJujTu1xq01ro57s4eHh4R3lzY5VzQ5C5QXxLPQvEgMeHh7eUd5m823HY20bYtakeBEIPDw8vKO8/VAqvzML3CYEeHh4eDd47WGmvMm7SQynimw8PDy8e7x2YH9qrNUCkmK6+B/i4eHhLXj7I1D5Qs8mibpXjYeHh3eIl2OSgVbbjMgTxmaohoeHh3eK1x4RmG33+f22gI6KaTw8PLwLvFlbIV9o+/7kb6OUhoeHh3eZ1xa+q3HU0YTx+Fs8PDy8D/I2CaM9iLBvVdSJAQ8PD2/N22zu+Wa9Ga3NQo+Hh4d3m5cjZ0tpj20dmOzh4eHhXeC1ZXGy0PzwwaZ5kTRK8PDw8O7xNss6u4kngR4OyfDw8PCO8tojU5ujV6dGX0mDGA8PD+82b7bHbpJB/p7Z4S08PDy8G7zv8poNwJIF5YcMiqYzHh4e3gVe26pIiuM2HO2b2yfx8PDwbvDyTTlpuebF9/7J4egLDw8P7xCvTQZ56yEJU1vEFwU9Hh4e3h/gnW0uJO/M08mBxICHh4d3lDf7ZFsQ58Fazffw8PDw1rz8M/kmfg9ThB4PDw/vAq8dgOXgp2dm7E0LGA8PD+8Q7x8TCfk+q2ArRAAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/设计模式/">设计模式</a></div><div class="post-nav"><a class="pre" href="/2019/09/02/Java中将List转为Map/">Java中将List转为Map</a><a class="next" href="/2019/07/22/JavaDaily/">JavaDaily</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"><input type="hidden" name="si" value="https://dcrunnn.github.io"><input name="tn" type="hidden" value="bds"><input name="cl" type="hidden" value="3"><input name="ct" type="hidden" value="2097152"><input name="s" type="hidden" value="on"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/SpringBoot/">SpringBoot</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/LeetCode/">LeetCode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maven/">Maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vue/">Vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情/">心情</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术整理/">技术整理</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/技术整理/Windows/">Windows</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构与算法/">数据结构与算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/编程规范/">编程规范</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/优化/" style="font-size: 15px;">优化</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Enum/" style="font-size: 15px;">Enum</a> <a href="/tags/Java8/" style="font-size: 15px;">Java8</a> <a href="/tags/Stream/" style="font-size: 15px;">Stream</a> <a href="/tags/学习记录/" style="font-size: 15px;">学习记录</a> <a href="/tags/参数传递/" style="font-size: 15px;">参数传递</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/心情/" style="font-size: 15px;">心情</a> <a href="/tags/数据结构与算法/" style="font-size: 15px;">数据结构与算法</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/LeetCode/" style="font-size: 15px;">LeetCode</a> <a href="/tags/数据恢复/" style="font-size: 15px;">数据恢复</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/前后端分离/" style="font-size: 15px;">前后端分离</a> <a href="/tags/技术/" style="font-size: 15px;">技术</a> <a href="/tags/SpringSecurity/" style="font-size: 15px;">SpringSecurity</a> <a href="/tags/jwt/" style="font-size: 15px;">jwt</a> <a href="/tags/编程/" style="font-size: 15px;">编程</a> <a href="/tags/知识/" style="font-size: 15px;">知识</a> <a href="/tags/阿里云镜像/" style="font-size: 15px;">阿里云镜像</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/webpack/" style="font-size: 15px;">webpack</a> <a href="/tags/大数据/" style="font-size: 15px;">大数据</a> <a href="/tags/分布式ETL工具/" style="font-size: 15px;">分布式ETL工具</a> <a href="/tags/分布式SQL引擎/" style="font-size: 15px;">分布式SQL引擎</a> <a href="/tags/分布式数据采集工具/" style="font-size: 15px;">分布式数据采集工具</a> <a href="/tags/分布式文件系统/" style="font-size: 15px;">分布式文件系统</a> <a href="/tags/分布式消息队列/" style="font-size: 15px;">分布式消息队列</a> <a href="/tags/分布式计算框架/" style="font-size: 15px;">分布式计算框架</a> <a href="/tags/分布式资源管理框架/" style="font-size: 15px;">分布式资源管理框架</a> <a href="/tags/线程池/" style="font-size: 15px;">线程池</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/内存模型/" style="font-size: 15px;">内存模型</a> <a href="/tags/Lambda/" style="font-size: 15px;">Lambda</a> <a href="/tags/字符串/" style="font-size: 15px;">字符串</a> <a href="/tags/滑动窗口/" style="font-size: 15px;">滑动窗口</a> <a href="/tags/矩阵/" style="font-size: 15px;">矩阵</a> <a href="/tags/歌曲/" style="font-size: 15px;">歌曲</a> <a href="/tags/编程规范/" style="font-size: 15px;">编程规范</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/12/06/设计模式理论篇-模板方法模式/">设计模式理论篇 | 模板方法模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/02/大数据理论篇-分布式SQL引擎Inceptor/">大数据理论篇 | 分布式SQL引擎Inceptor</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/30/设计模式理论篇-面向对象设计原则/">设计模式理论篇 | 面向对象设计原则</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/30/设计模式理论篇-设计模式综述/">设计模式理论篇 | 设计模式综述</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/30/设计模式理论篇-责任链模式/">设计模式理论篇 | 责任链模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/30/设计模式理论篇-装饰者模式/">设计模式理论篇 | 装饰者模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/30/大数据理论篇-分布式消息队列Kafka/">大数据理论篇 | 分布式消息队列Kafka</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/30/大数据理论篇-分布式数据采集工具Flume/">大数据理论篇 | 分布式数据采集工具Flume</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/30/大数据理论篇-分布式ETL工具Sqoop/">大数据理论篇 | 分布式ETL工具Sqoop</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/29/大数据理论篇-分布式计算框架（Spark篇）/">大数据理论篇 | 分布式计算框架（Spark篇）</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 链接</i></div><ul></ul><a href="http://www.github.com/DCRUNNN" title="Github" target="_blank">Github</a><ul></ul><a href="https://instagram.com/youdontknowdc" title="Instagram" target="_blank">Instagram</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Blog of DC.</a><!--|  Powered by--><!--a(rel='nofollow', target='_blank', href='https://hexo.io')  Hexo.--><!--a(rel='nofollow', target='_blank', href='https://github.com/tufu9441/maupassant-hexo')  Theme--><!--|  by--><!--a(rel='nofollow', target='_blank', href='https://github.com/pagecho')  Cho.--></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>