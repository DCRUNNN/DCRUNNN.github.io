<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="DC's Blog"><title>《大型网站技术架构：核心原理与案例分析》读书笔记 | Blog of DC</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">《大型网站技术架构：核心原理与案例分析》读书笔记</h1><a id="logo" href="/.">Blog of DC</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">《大型网站技术架构：核心原理与案例分析》读书笔记</h1><div class="post-meta">Sep 29, 2019<span> | </span><span class="category"><a href="/categories/读书笔记/">读书笔记</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#第一章-大型网站架构演化"><span class="toc-text">第一章 大型网站架构演化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#大型网站软件系统的特点"><span class="toc-text">大型网站软件系统的特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#大型网站架构演化发展历程"><span class="toc-text">大型网站架构演化发展历程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#大型网站架构演化的价值观"><span class="toc-text">大型网站架构演化的价值观</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#网站架构设计误区"><span class="toc-text">网站架构设计误区</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第二章-大型网站架构模式"><span class="toc-text">第二章 大型网站架构模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#网站架构模式"><span class="toc-text">网站架构模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-分层"><span class="toc-text">1. 分层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-分割"><span class="toc-text">2. 分割</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-分布式"><span class="toc-text">3. 分布式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-集群"><span class="toc-text">4. 集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-缓存"><span class="toc-text">5. 缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-异步"><span class="toc-text">6. 异步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-冗余"><span class="toc-text">7. 冗余</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-自动化"><span class="toc-text">8. 自动化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-安全"><span class="toc-text">9. 安全</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第三章-大型网站核心架构要素"><span class="toc-text">第三章 大型网站核心架构要素</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-性能"><span class="toc-text">1. 性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-可用性"><span class="toc-text">2. 可用性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-伸缩性"><span class="toc-text">3. 伸缩性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-扩展性"><span class="toc-text">4. 扩展性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安全性"><span class="toc-text">安全性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#第四章-瞬时响应：网站的高性能架构"><span class="toc-text">第四章 瞬时响应：网站的高性能架构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#网站性能测试"><span class="toc-text">网站性能测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#网站性能测试指标"><span class="toc-text">网站性能测试指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#性能测试方法"><span class="toc-text">性能测试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#性能优化策略"><span class="toc-text">性能优化策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web前端性能优化"><span class="toc-text">Web前端性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-浏览器访问优化"><span class="toc-text">1. 浏览器访问优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-CDN加速"><span class="toc-text">2. CDN加速</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-反向代理"><span class="toc-text">3. 反向代理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用服务器性能优化"><span class="toc-text">应用服务器性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-分布式缓存"><span class="toc-text">1. 分布式缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#缓存的基本原理"><span class="toc-text">缓存的基本原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#合理使用缓存"><span class="toc-text">合理使用缓存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分布式缓存架构"><span class="toc-text">分布式缓存架构</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="post-content"><h1 id="第一章-大型网站架构演化"><a href="#第一章-大型网站架构演化" class="headerlink" title="第一章 大型网站架构演化"></a>第一章 大型网站架构演化</h1><h2 id="大型网站软件系统的特点"><a href="#大型网站软件系统的特点" class="headerlink" title="大型网站软件系统的特点"></a>大型网站软件系统的特点</h2><ul>
<li>高并发，大流量</li>
<li>高可用：7*24小时</li>
<li>海量数据</li>
<li>用户分布广泛，网络情况复杂</li>
<li>安全环境恶劣</li>
<li>需求快速变更，发布频繁</li>
<li>渐进式发展</li>
</ul>
<h2 id="大型网站架构演化发展历程"><a href="#大型网站架构演化发展历程" class="headerlink" title="大型网站架构演化发展历程"></a>大型网站架构演化发展历程</h2><ol>
<li><p>初始阶段的网络结构<br>小型网站，应用程序、数据库、文件等所有资源都在一台服务器上。</p>
</li>
<li><p>应用服务和数据服务分离<br>应用和数据分离，网站使用三台服务器：</p>
</li>
</ol>
<ul>
<li>应用服务器：要处理大量业务逻辑，需要更快更强大的CPU</li>
<li>数据库服务器：需要快速磁盘检索和数据缓存，需要更快的硬盘和更大的内存</li>
<li>文件服务器：需要存储大量用户上传的文件，需要更大的硬盘</li>
</ul>
<ol start="3">
<li>使用缓存改善网站性能</li>
</ol>
<ul>
<li>二八定律，大部分业务访问集中在一小部分数据上，将这一小部分数据缓存在内存中</li>
<li>网站使用的缓存有两种：<ul>
<li>缓存在应用服务器上的本地缓存：访问速度快，但内存有限，缓存数据量有限，可能会出现和应用程序争用内存的情况</li>
<li>缓存在专门的分布式缓存服务器上的远程缓存：可以使用集群的方式</li>
</ul>
</li>
</ul>
<ol start="4">
<li>使用应用服务器集群改善网站的并发处理能力</li>
</ol>
<ul>
<li>当一台服务器的处理能力、存储空间不足时，不要企图去换更强大的服务器，更恰当的做法是增加一台服务器分担原有服务器的访问及存储压力，从而实现系统的可伸缩性。</li>
<li>通过负载均衡调度服务器，可将用户的访问请求分发到应用服务器集群中的任何一台服务器上。</li>
</ul>
<ol start="5">
<li>数据库读写分离</li>
</ol>
<ul>
<li>使用缓存后，仍然有有一部分读操作（缓存访问未命中、缓存过期）和全部的写操作，需要访问数据库</li>
<li>数据库提供主从热备功能，配置两台数据库主从关系，将一台数据库服务器的数据更新同步到另一条服务器上，实现数据库读写分离，改善数据库负载压力。</li>
<li>往从库中读数据，往主库中写数据，主库到从库之间主从复制，更新从库</li>
</ul>
<ol start="6">
<li>使用反向代理和CDN加速网站响应</li>
</ol>
<ul>
<li>CDN和反向代理的基本原理都是缓存，目的都是尽早返回数据给用户</li>
<li>CDN：部署在网络提供商的机房，用户可以从距离自己最近的网络提供商机房获取数据</li>
<li>反向代理：部署在网站的中心机房，用户请求到达中心机房时，首先访问的服务器是反向代理服务器，如果反向代理服务器中缓存着用户请求的资源，就将其直接返回给用户</li>
</ul>
<ol start="7">
<li>使用分布式文件系统和分布式数据库系统</li>
</ol>
<ul>
<li>分布式数据库：网站数据库拆分的最后手段，只有在单表数据规模非常庞大的时候才使用。不到不得已时，网站更常用的数据库拆分手段是业务分库，将不同业务的数据库部署在不同的物理服务器上。</li>
</ul>
<ol start="8">
<li>使用NOSQL和搜索引擎</li>
</ol>
<ul>
<li>网站需要采用一些非关系数据库技术（如NoSQL），和非数据库查询技术（如搜索引擎）。</li>
<li>这些技术对可伸缩的分布式特性具有更好的支持。</li>
<li>应用服务器通过一个统一数据访问模块访问各种数据，减轻应用程序管理多个数据源的麻烦。</li>
</ul>
<ol start="9">
<li>业务拆分</li>
</ol>
<ul>
<li>使用分而治之的手段将整个网站业务分成不同的产品线，分归不同的业务团队负责。</li>
<li>技术也会根据产品线划分，每个应用独立部署维护，应用之间可以通过超链接建立关系，也可以通过消息队列进行数据分发，最多的还是通过访问同一个数据存储系统来构成一个关联的完整系统。</li>
</ul>
<ol start="10">
<li>分布式服务</li>
</ol>
<ul>
<li>各个应用系统都需要执行许多相同的业务操作，可以将这些共用的业务提取出来，独立部署。由这些可复用的业务连接数据库，提供共用业务服务，应用系统只需管理用户界面，通过分布式服务调用共用业务服务完成具体业务操作。</li>
</ul>
<h2 id="大型网站架构演化的价值观"><a href="#大型网站架构演化的价值观" class="headerlink" title="大型网站架构演化的价值观"></a>大型网站架构演化的价值观</h2><ul>
<li>大型网站都是从小型网站发展而来，在网站还很小的时候就去追求网站的架构是舍本逐末，得不偿失的。小型网站最需要做的就是为用户提供好的服务来创造价值，得到用户的认可，活下去，野蛮生长。</li>
<li>大型网站架构技术的核心价值是随网站所需灵活应对</li>
<li>驱动大型网站技术发展的主要力量是网站的业务发展</li>
</ul>
<h2 id="网站架构设计误区"><a href="#网站架构设计误区" class="headerlink" title="网站架构设计误区"></a>网站架构设计误区</h2><ul>
<li>一味追随大公司的解决方案</li>
<li>为了技术而技术：不要脱离网站业务发展的实际，一味追求时髦的新技术</li>
<li>企图用技术解决所有问题：技术用来解决业务问题的，业务的问题也可以通过业务的手段去解决。</li>
</ul>
<h1 id="第二章-大型网站架构模式"><a href="#第二章-大型网站架构模式" class="headerlink" title="第二章 大型网站架构模式"></a>第二章 大型网站架构模式</h1><h2 id="网站架构模式"><a href="#网站架构模式" class="headerlink" title="网站架构模式"></a>网站架构模式</h2><h3 id="1-分层"><a href="#1-分层" class="headerlink" title="1. 分层"></a>1. 分层</h3><ul>
<li>将系统在横向维度上切分成几个部分，每个部分负责一部分相对比较单一的职责，然后通过上层对下层的依赖和调用组成一个完整的系统。</li>
<li>将网站软件系统分为应用层、服务层、数据层</li>
<li>大的分层结构内部还可以继续分层：<ul>
<li>应用层：细分为视图层、业务逻辑层</li>
<li>服务层：细分为数据接口层、逻辑处理层</li>
<li>数据层</li>
</ul>
</li>
</ul>
<h3 id="2-分割"><a href="#2-分割" class="headerlink" title="2. 分割"></a>2. 分割</h3><ul>
<li>纵向对软件进行切分</li>
<li>将不同的功能和服务分割开来，包装成高内聚低耦合的模块单元，一方面有助于软件的开发和维护；另一方面便于不同模块的分布式部署，提高网站的并发处理能力和功能扩展能力</li>
</ul>
<h3 id="3-分布式"><a href="#3-分布式" class="headerlink" title="3. 分布式"></a>3. 分布式</h3><ul>
<li>分层和分割的一个主要目的是为了切分后的模块便于分布式部署，即将不同模块部署在不同的服务器上，通过远程调用协同工作。</li>
<li>分布式缺点：<ul>
<li>服务调用必须通过网络，可能影响性能</li>
<li>服务器宕机的概率也增大</li>
<li>一台服务器宕机造成服务不可用可能导致许多应用不可访问，网站可用性降低</li>
<li>在分布式环境中保持数据一致性也非常困难，分布式事务也难以保证</li>
<li>导致网站依赖错综复杂，开发管理维护困难</li>
<li>因此不要为了分布式而分布式</li>
</ul>
</li>
<li>常用分布式方案：</li>
</ul>
<ol>
<li><p><strong>分布式应用和服务</strong><br>将分层和分割后的应用和服务模块分布式部署，改善性能，提高并发性，减少数据库连接资源消耗，使不同应用复用共同的服务，便于业务功能扩展</p>
</li>
<li><p><strong>分布式静态资源</strong><br>网站的静态资源（JS、CSS、Logo图片等）独立分布式部署，并采用独立的域名，即常说的动静分离。</p>
</li>
<li><p><strong>分布式计算</strong><br>使用Hadoop及其MapReduce分布式计算框架进行批处理计算，特点是移动计算而不是移动数据，将计算程序分发到数据所在的位置以加速计算和分布式计算。</p>
</li>
</ol>
<p>此外，还有可以支持网站线上服务器配置实时更新的<strong>分布式配置</strong>；分布式环境下实现并发和协同的<strong>分布式锁</strong>；支持云存储的<strong>分布式文件系统</strong>等。</p>
<h3 id="4-集群"><a href="#4-集群" class="headerlink" title="4. 集群"></a>4. 集群</h3><ul>
<li>对于用户访问集中的模块（如网站首页），还需要将独立部署的服务器集群化，即多台服务器部署相同应用，构成一个集群，通过负载均衡设备共同对外提供服务。</li>
<li>可以提高系统的可用性</li>
</ul>
<h3 id="5-缓存"><a href="#5-缓存" class="headerlink" title="5. 缓存"></a>5. 缓存</h3><ul>
<li>CDN：内容分发网络，部署在距离终端用户最近的网络服务商，在这里缓存网站的一些静态资源或较少变化的数据，可以就近以最快速度返回给用户，视频网站和门户网站会将用户访问量大的热点内容缓存在CDN</li>
<li>反向代理：属于网站前端架构的一部分，部署在网站的前端，当用户请求到达网站的数据中心时，最先访问到的就是反向代理服务器，这里缓存网站的静态资源，无需将请求继续转发给应用服务器就能返回给用户</li>
<li>本地缓存：应用服务器本地缓存热点数据，应用程序可以在本机内存中直接访问数据无需访问数据库</li>
<li>分布式缓存：本地缓存内存空间有限，使用分布式缓存，将数据缓存在一个专门的分布式缓存集群中，应用程序通过网络通信访问缓存数据</li>
</ul>
<p>使用缓存条件：</p>
<ol>
<li>数据访问热点不均衡（冷、热数据）</li>
<li>数据在某个时间段内有效，不会很快过期，否则缓存的数据就会因失效而产生脏读，影响结果的正确性。</li>
</ol>
<h3 id="6-异步"><a href="#6-异步" class="headerlink" title="6. 异步"></a>6. 异步</h3><ul>
<li>将一个业务操作分成多个阶段，每个阶段之间通过共享数据的方式异步执行进行协作。</li>
<li>在单一服务器内部可通过多线程共享内存队列的方式实现异步，处在业务操作前面的线程将输出写入队列，后面的线程从队列中读取数据进行处理。</li>
<li>在分布式系统中，多个服务器集群通过分布式消息队列实现异步，分布式消息队列可以看做内存队列的分布式部署。</li>
<li>异步架构是典型的生产者消费者模式，二者不存在直接调用。</li>
</ul>
<h3 id="7-冗余"><a href="#7-冗余" class="headerlink" title="7. 冗余"></a>7. 冗余</h3><ul>
<li>服务器冗余运行，数据冗余备份，这样当某台服务器宕机时，可以将其上的服务和数据访问转移到其他机器上。</li>
<li>访问和负载很小的服务也必须部署至少两台服务器构成一个集群，其目的就是通过冗余实现服务高可用。</li>
<li>数据库除了定期备份，存档保存，实现冷备份外，为了保证在线业务高可用，还需要对数据库进行主从分离，实时同步实现热备份。</li>
<li>为了抵御自然灾害等不可抗力导致的网站完全瘫痪，某些大型网站会对整个数据中心进行备份，全球范围内部署灾备数据中心，网站程序和数据实时同步到多个灾备数据中心。</li>
</ul>
<h3 id="8-自动化"><a href="#8-自动化" class="headerlink" title="8. 自动化"></a>8. 自动化</h3><ul>
<li>目前大型网站的自动化架构设计主要集中在发布运维方面。</li>
<li>发布过程自动化、自动化代码管理、自动化测试、自动化安全检测、自动化部署、自动化监控、自动化告警、自动化失效转义、自动化失效恢复、自动化降级、自动化分配资源</li>
</ul>
<h3 id="9-安全"><a href="#9-安全" class="headerlink" title="9. 安全"></a>9. 安全</h3><ul>
<li>密码、手机校验码进行身份认证</li>
<li>登录、交易等操作需要对网络通信进行加密</li>
<li>网站服务器上存储的敏感数据（如用户信息）等也进行加密处理</li>
<li>为了防止机器人程序滥用网络资源攻击网站，网站使用验证码进行识别</li>
<li>对于常见的用于攻击网站的XSS攻击、SQL注入、进行编码转换等响应处理</li>
<li>对于垃圾信息、敏感信息进行过滤</li>
<li>对交易转账等重要操作根据交易模式和交易信息进行风险控制</li>
</ul>
<h1 id="第三章-大型网站核心架构要素"><a href="#第三章-大型网站核心架构要素" class="headerlink" title="第三章 大型网站核心架构要素"></a>第三章 大型网站核心架构要素</h1><ul>
<li>一般来说，除了系统功能需求外，软件架构还需要关注性能、可用性、伸缩性、扩展性和安全性这5个架构要素。</li>
</ul>
<h2 id="1-性能"><a href="#1-性能" class="headerlink" title="1. 性能"></a>1. 性能</h2><ul>
<li>从用户浏览器到数据库，影响用户请求的所有环节都可以进行性能优化</li>
</ul>
<ol>
<li>浏览器端：浏览器缓存、页面压缩、合理布局页面、减少Cookie传输、CDN（将网站静态内容分发至离用户最近的网络服务商机房，使用户通过最大UN访问路径获取数据）、在网站机房部署反向代理服务器（缓存热点文件，加快请求响应速度，减轻应用服务器负载压力）</li>
<li>应用服务器端：使用服务器本地缓存和分布式缓存（通过缓存在内存中的热点数据处理用户请求，加快请求处理过程，减轻数据库负载压力）、通过异步操作将用户请求发送至消息队列等待后续任务处理，当前请求直接返回响应给用户、将多台应用服务器组成一集群共同对外服务</li>
<li>在代码层面：通过使用多线程、改善内存管理等手段优化性能</li>
<li>数据库服务器端：索引、缓存、SQL优化、使用NoSQL等非关系型数据库（优化数据模型、存储结构、伸缩特性）</li>
</ol>
<h2 id="2-可用性"><a href="#2-可用性" class="headerlink" title="2. 可用性"></a>2. 可用性</h2><ul>
<li>高可用设计的目标就是当服务器宕机的时候，服务或者应用依然可用</li>
<li>网站高可用的主要手段是冗余，应用部署在多台服务器上同时提供访问，数据存储在多太服务器上互相备份，任何一台服务器宕机都不会影响应用的整体可用，也不会导致数据丢失<ul>
<li>应用服务器：多台应用服务器通过负载均衡设备组成一个集群共同对外提供服务</li>
<li>存储服务器：需要对数据进行实时备份，当服务器宕机时需要将数据访问转移到可用的服务器上，并进行数据恢复</li>
</ul>
</li>
<li>除了运行环境，网站的高可用还需要软件开发过程的质量保证。</li>
</ul>
<h2 id="3-伸缩性"><a href="#3-伸缩性" class="headerlink" title="3. 伸缩性"></a>3. 伸缩性</h2><ul>
<li>所谓伸缩性是指通过不断向集群中加入服务器的手段来缓解不断上升的用户并发访问压力和不断增长的数据存储需求</li>
<li>衡量架构伸缩性的主要标准就是是否可以用多台服务器构建集群，是否容易向集群中添加新的服务器，加入新的服务器后是否可以提供和原来的服务器无差别的服务，集群中可容纳的总的服务器数量是否有限制<ul>
<li>对于应用服务器集群，只要服务器上不保存数据，所有服务器都是对等的，使用合适的负载均衡设备即可向集群中不断加入服务器</li>
<li>对于缓存服务器集群，加入新的服务器可能导致缓存路由失效，进而导致集群中大部分缓存数据都无法访问，需要改进缓存路由算法保证缓存数据的可访问性。</li>
<li>虽然关系数据库支持数据复制、主从热备等机制，但是难以做到大规模集群的可伸缩性，因此关系数据库的集群伸缩性方案必须在数据库之外实现，通过路由分区等手段将部署有多个数据库的服务器组成一个集群。</li>
<li>对于大部分NoSQL数据库产品，先天就是为海量数据而生，可以做到在较少运维参与下实现集群规模的线性伸缩。</li>
</ul>
</li>
</ul>
<h2 id="4-扩展性"><a href="#4-扩展性" class="headerlink" title="4. 扩展性"></a>4. 扩展性</h2><ul>
<li>网站的扩展性架构直接关注网站的功能需求</li>
<li>网站可伸缩架构的主要手段是事件驱动架构和分布式服务</li>
<li>事件驱动架构：通常利用消息队列实现，将用户请求和其他业务事件构造成消息发布到消息队列，消息的处理者作为消费者从消息队列中获取消息进行处理。</li>
<li>分布式服务：将业务和可复用服务分离开来，通过分布式服务框架调用，新增产品可以通过调用可复用服务实现自身业务逻辑；可复用服务升级变更时，也可以通过提供多版本服务对应用实现透明升级，不需要强制应用同步变更</li>
<li>吸引第三方开发者，使用大型网站提供的开发平台接口，使用网站数据开发周边产品，扩展网站业务</li>
</ul>
<h2 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h2><ul>
<li>网站的安全架构是保护网站不受恶意访问和攻击，保护网站的重要数据不被窃取</li>
</ul>
<h1 id="第四章-瞬时响应：网站的高性能架构"><a href="#第四章-瞬时响应：网站的高性能架构" class="headerlink" title="第四章 瞬时响应：网站的高性能架构"></a>第四章 瞬时响应：网站的高性能架构</h1><h2 id="网站性能测试"><a href="#网站性能测试" class="headerlink" title="网站性能测试"></a>网站性能测试</h2><h3 id="网站性能测试指标"><a href="#网站性能测试指标" class="headerlink" title="网站性能测试指标"></a>网站性能测试指标</h3><ol>
<li>响应时间</li>
<li>并发数</li>
</ol>
<ul>
<li>系统能够同时处理请求的数目，对网站而言，并发数即网站并发用户数，指同时提交请求的用户数目。</li>
<li>为了真实模拟用户行为，测试程序并不是启动多线程然后不停地发送请求，而是在两次请求之间加入一个随机等待时间，这个时间被称作思考时间。</li>
</ul>
<ol start="3">
<li>吞吐量</li>
</ol>
<ul>
<li>指单位时间内系统处理的请求数量（请求数/秒、页面数/秒、访问人数/天、处理的业务数/小时等来衡量）</li>
</ul>
<ol start="4">
<li>性能计数器</li>
</ol>
<ul>
<li>描述服务器或操作系统性能的一些数据指标（System Load系统负载、对象与线程数、内存使用、CPU使用、磁盘与网络I/O等指标）</li>
<li>对这些指标设置告警阈值，当监控系统发现性能计数器超过阈值时，及时告警</li>
</ul>
<h3 id="性能测试方法"><a href="#性能测试方法" class="headerlink" title="性能测试方法"></a>性能测试方法</h3><ul>
<li>性能测试</li>
<li>负载测试</li>
<li>压力测试</li>
<li>稳定性测试</li>
</ul>
<h3 id="性能优化策略"><a href="#性能优化策略" class="headerlink" title="性能优化策略"></a>性能优化策略</h3><ol>
<li>性能分析：检查请求处理的各个环节的日志，分析哪个环节响应时间不合理、超出预期；然后检查监控数据，分析影响性能的主要因素是内存、磁盘、网络还是CPU，是代码问题还是架构设计不合理，或者系统资源确实不足。</li>
<li>性能优化：Web前端性能优化、应用服务器性能优化、存储服务器性能优化</li>
</ol>
<h2 id="Web前端性能优化"><a href="#Web前端性能优化" class="headerlink" title="Web前端性能优化"></a>Web前端性能优化</h2><p>Web前端指浏览器加载、网站视图模型、图片服务、CDN服务等，主要优化手段有优化浏览器访问、使用反向代理、CDN等</p>
<h3 id="1-浏览器访问优化"><a href="#1-浏览器访问优化" class="headerlink" title="1. 浏览器访问优化"></a>1. 浏览器访问优化</h3><ul>
<li>减少http请求<ul>
<li>合并CSS、合并JS、合并图片，将浏览器一次访问需要的JS、CSS合并成一个文件，这样浏览器只需一次请求。合并图片时，如果每张图片都有不同的超链接，可通过CSS偏移响应鼠标点击操作，构造不同的URL</li>
</ul>
</li>
<li>使用浏览器缓存<ul>
<li>缓存CSS、JS、LOGO、图标等静态资源文件，通过设置HTTP头中Cache-Control和Expires的属性，可设定浏览器缓存及缓存时间。</li>
<li>若静态资源文件变化需要及时应用到客户端浏览器，可通过改变文件名实现。即更新JS文件时不是更新JS文件内容，而是生成一个新的JS文件并更新HTML文件中的引用。</li>
<li>更新静态资源时，应采用批量更新的方法，应一个文件一个文件逐步更新，并有一定的间隔时间，以免浏览器turnaround大量缓存失效，集中更新缓存，造成服务器负载骤增、网络堵塞等情况。</li>
</ul>
</li>
<li>启用压缩<ul>
<li>在服务器端对文件进行压缩，在浏览器端对文件解压缩，减少通信传输的数据量。（压缩HTML、CSS、JS等文件，但压缩对服务器和浏览器会产生一定压力，要对通信带宽和服务器资源权衡考虑）</li>
</ul>
</li>
<li>将CSS放在页面最上面，JS放在页面最下面<ul>
<li>浏览器会在下载完全部CSS之后才对整个页面进行渲染</li>
<li>浏览器在加载JS后立即执行，有可能会阻塞整个页面，除非页面解析需要用到JS</li>
</ul>
</li>
<li>减少Cookie传输<ul>
<li>Cookie会包含在每次请求和相应中，Cookie太大会影响数据传输，尽量减少Cookie中传输的数据量</li>
<li>对于某些静态资源的访问，如CSS、JS等，发送Cookie没有意义，可以考虑静态资源使用独立域名访问，避免请求静态资源时发送Cookie，减少Cookie传输次数</li>
</ul>
</li>
</ul>
<h3 id="2-CDN加速"><a href="#2-CDN加速" class="headerlink" title="2. CDN加速"></a>2. CDN加速</h3><ul>
<li>CDN即内容分发网络，本质仍是一个缓存，</li>
<li>网络访问第一跳，CDN部署在网络运营商的机房，将数据缓存在离用户最近的地方，最短路径返回响应，加快用户访问速度，减少数据中心负载压力。</li>
<li>CDN能够缓存的一般是静态资源，如图片、文件、CSS、Script脚本、静态网页等</li>
</ul>
<h3 id="3-反向代理"><a href="#3-反向代理" class="headerlink" title="3. 反向代理"></a>3. 反向代理</h3><ul>
<li>反向代理服务器位于网站机房一侧，代理网站Web服务器接收HTTP请求</li>
<li>反向代理服务器也可以保护网站安全</li>
<li>反向代理服务器也可以通过配置缓存功能加速Web请求。当用户第一次访问静态内容的时候，静态内容就被缓存在反向代理服务器上，这样当其他用户访问该静态内容时，就可以直接从反向代理服务器返回。</li>
<li>有些网站会把动态内容也缓存在代理服务器上，当这些动态内容有变化时，通过内部通知机制通知反向代理缓存失效，反向代理会重新加载最新的动态内容并再次缓存起来。</li>
<li>反向代理也可以实现负载均衡的功能，通过负载均衡构建的应用集群可以提高系统总体处理能力，改善网站高并发情况下的性能。</li>
</ul>
<h2 id="应用服务器性能优化"><a href="#应用服务器性能优化" class="headerlink" title="应用服务器性能优化"></a>应用服务器性能优化</h2><h3 id="1-分布式缓存"><a href="#1-分布式缓存" class="headerlink" title="1. 分布式缓存"></a>1. 分布式缓存</h3><h4 id="缓存的基本原理"><a href="#缓存的基本原理" class="headerlink" title="缓存的基本原理"></a>缓存的基本原理</h4><ul>
<li>网站性能优化第一定律：优先考虑使用缓存优化性能</li>
<li>缓存的本质是一个内存hash表，数据缓存以一对key-value的形式存储在内存hash表中，hash表数据读写的时间复杂度是O(1)，hashcode可以理解为对象的唯一标识符</li>
<li>缓存主要存放读写比很高、很少变化的数据，如商品的类目信息、热门词的搜索列表信息、热门商品信息等</li>
<li>应用程序读取数据时，先到缓存中读取，如果读取不到或数据已失效，再访问数据库，并将数据写入缓存。</li>
<li>二八定律：80%的访问落在20%的数据上，利用hash表和内存的高速访问特性，将这20%的数据缓存起来，可以很好的改善系统性能。</li>
</ul>
<h4 id="合理使用缓存"><a href="#合理使用缓存" class="headerlink" title="合理使用缓存"></a>合理使用缓存</h4><ul>
<li>不应缓存频繁修改的数据（读写比在2:1以上缓存才有意义）</li>
<li>如果系统访问的数据没有热点，不遵循二八定律，即大部分数据访问没有集中在小部分数据上，缓存就没有意义，因为大部分数据还没有被再次访问就已经被挤出内存了</li>
<li>数据不一致和脏读：<ul>
<li>缓存超过失效时间，从数据库中重新加载，有一定时间的数据不一致</li>
<li>若数据更新时立即更新缓存，则也会带来更多系统开销和事务一致性的问题</li>
</ul>
</li>
<li>缓存可用性：<ul>
<li>缓存雪崩：当缓存服务崩溃时，数据库不能承受那么大压力而宕机，进而导致整个网站不可用</li>
<li>分布式缓存服务器集群</li>
</ul>
</li>
<li>缓存预热：在缓存系统启动时预加载热点数据</li>
<li>缓存穿透：持续高并发地请求某个不存在的数据，由于缓存中没有该数据，所有的请求都会落到数据库上，数据库压力很大，甚至崩溃。简单的对策是将不存在的数据也缓存起来（value值为null）</li>
</ul>
<h4 id="分布式缓存架构"><a href="#分布式缓存架构" class="headerlink" title="分布式缓存架构"></a>分布式缓存架构</h4></div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="https://dcrunnn.github.io/2019/09/29/《大型网站技术架构：核心原理与案例分析》读书笔记/" data-id="ck3fgqj85001w5kub1zhzsjmb" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQ4AAAEOCAAAAABd2qZ5AAAD40lEQVR42u3aS27cQAwFQN//0g6QVYDE8nskbU+A0srwzLS6SwuKn7e3+Hr/ff35999Xu9rzOsn6yQpvX3HhwIEDB47TzSXrPP8/p0weQ7Lb5Fc4cODAgeOWI99KG6dmB0uOlxw+PyMOHDhw4Ph+jk3i136nvftHAR4HDhw4cPwvHG3YuypQ5qvhwIEDB46f5chbOLOG03PRMKHPv/NNtVIcOHDgwDGZPYjC6uv/fXzhwIEDB464RTQLukmoywN2EmiThlN9Ohw4cODAseZot7VpNW3eAmaDEcNSIw4cOHDgWHA8b30TAvNGUR6Mr5K3D9fHgQMHDhynHJu20yx5a2n24wuffB8HDhw4cKw59qnXpmCXlxRnR5qVJnHgwIEDx55jVVmMb5yjJ6G6TfAKShw4cODAseZIioN5SJs1sZ4DcPSmEJcj22/iwIEDB45NBz8PWnlozA+ZtL7aQYei+IgDBw4cONYc7QBBkkoNhwnKldsxi6L0iQMHDhw4FhxtutWG3uQuyacJervOPz7FgQMHDhxrjs1YQDvW1iZj+fhdUigsHjwOHDhw4FhwXA0obNKw/F55kyzfJw4cOHDguOVIrtkNhjcL9jArNc7GLHDgwIEDx4xjdoC8CTQLbFdDDHlgxoEDBw4cVxx5kW52g7ztlIfMHC4vIOLAgQMHjluOdhObI12FzM3+i7cPHDhw4MBRcuwDYbKt9vm8x1f7ohC9a+DAgQMHjgVHkg7NinSzrlcbkjetrCKjxYEDBw4cMccsuUoC5AYxCbr5gyweEg4cOHDgWHC0S+e3bDeUBNp2OK9dBwcOHDhw7Dk2LaXblKxlmgXsYpQBBw4cOHAsOG5bUHlTp11/VnacJYQ4cODAgWPG0Zbk9mnVV5QIk7Qt+RQHDhw4cFxx5KnXcyjdHzsP8PtELhplwIEDBw4cC452iGFWyJvhJgXKPI2MGk44cODAgWPNMWvbtBtqj7TZW37hwIEDB44rjs3wQR4C8w7YQbBsB+OeXwVw4MCBA0fJsWnhJMlYEdLicJuXL9tf4cCBAweOK448Edq3lPIgmuPuHwAOHDhw4LjimBXyZklU8gBm971dHwcOHDhwbNaftWfaYDYL5Hkb6Wp9HDhw4MCx52i3PhtNmIXq5PC3DTAcOHDgwHHF0QbXYaZYlhGvBh3a9XHgwIEDxxVHfrzZEFsb4fMRvVkaiQMHDhw4XoGjvXGSgLVA+4EJHDhw4MDxyhztKFtSLpwVDfNy5CffxIEDBw4cRxztEEMbxtrD50F086uDthMOHDhw4DgaaMgDbZuetQMN7SjDJinFgQMHDhyPd/wFpGMVR8uHCvoAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/编程/">编程</a></div><div class="post-nav"><a class="pre" href="/2019/10/24/LeetCode-子数组题型总结/">LeetCode|子数组题型总结</a><a class="next" href="/2019/09/19/MySQL通过ibd和frm文件恢复数据/">MySQL通过ibd和frm文件恢复数据</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"/><input type="hidden" name="si" value="https://dcrunnn.github.io"/><input name="tn" type="hidden" value="bds"/><input name="cl" type="hidden" value="3"/><input name="ct" type="hidden" value="2097152"/><input name="s" type="hidden" value="on"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/SpringBoot/">SpringBoot</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/LeetCode/">LeetCode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Maven/">Maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Vue/">Vue</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情/">心情</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术整理/">技术整理</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/技术整理/Windows/">Windows</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据结构与算法/">数据结构与算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/">读书笔记</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/读书笔记/编程规范/">编程规范</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔/">随笔</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/SpringSecurity/" style="font-size: 15px;">SpringSecurity</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Enum/" style="font-size: 15px;">Enum</a> <a href="/tags/Java8/" style="font-size: 15px;">Java8</a> <a href="/tags/学习记录/" style="font-size: 15px;">学习记录</a> <a href="/tags/参数传递/" style="font-size: 15px;">参数传递</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/Stream/" style="font-size: 15px;">Stream</a> <a href="/tags/数据结构与算法/" style="font-size: 15px;">数据结构与算法</a> <a href="/tags/心情/" style="font-size: 15px;">心情</a> <a href="/tags/前后端分离/" style="font-size: 15px;">前后端分离</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/LeetCode/" style="font-size: 15px;">LeetCode</a> <a href="/tags/数据恢复/" style="font-size: 15px;">数据恢复</a> <a href="/tags/MySQL/" style="font-size: 15px;">MySQL</a> <a href="/tags/SpringBoot/" style="font-size: 15px;">SpringBoot</a> <a href="/tags/技术/" style="font-size: 15px;">技术</a> <a href="/tags/知识/" style="font-size: 15px;">知识</a> <a href="/tags/jwt/" style="font-size: 15px;">jwt</a> <a href="/tags/多线程/" style="font-size: 15px;">多线程</a> <a href="/tags/编程/" style="font-size: 15px;">编程</a> <a href="/tags/阿里云镜像/" style="font-size: 15px;">阿里云镜像</a> <a href="/tags/大数据/" style="font-size: 15px;">大数据</a> <a href="/tags/分布式文件系统/" style="font-size: 15px;">分布式文件系统</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/webpack/" style="font-size: 15px;">webpack</a> <a href="/tags/歌曲/" style="font-size: 15px;">歌曲</a> <a href="/tags/线程池/" style="font-size: 15px;">线程池</a> <a href="/tags/优化/" style="font-size: 15px;">优化</a> <a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/内存模型/" style="font-size: 15px;">内存模型</a> <a href="/tags/字符串/" style="font-size: 15px;">字符串</a> <a href="/tags/Lambda/" style="font-size: 15px;">Lambda</a> <a href="/tags/滑动窗口/" style="font-size: 15px;">滑动窗口</a> <a href="/tags/编程规范/" style="font-size: 15px;">编程规范</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/11/26/大数据理论篇-分布式资源管理框架YARN/">大数据理论篇 | 分布式资源管理框架YARN</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/25/设计模式理论篇-享元模式/">设计模式理论篇 | 享元模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/25/大数据理论篇-分布式文件系统HDFS/">大数据理论篇 | 分布式文件系统HDFS</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/25/设计模式理论篇-状态模式/">设计模式理论篇 | 状态模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/25/设计模式理论篇-策略模式/">设计模式理论篇 | 策略模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/24/设计模式理论篇-代理模式/">设计模式理论篇 | 代理模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/24/设计模式理论篇-外观模式/">设计模式理论篇 | 外观模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/24/设计模式理论篇-观察者模式/">设计模式理论篇 | 观察者模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/24/设计模式理论篇-命令模式/">设计模式理论篇 | 命令模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/11/23/设计模式理论篇-适配器模式/">设计模式理论篇 | 适配器模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 链接</i></div><ul></ul><a href="http://www.github.com/DCRUNNN" title="Github" target="_blank">Github</a><ul></ul><a href="https://instagram.com/youdontknowdc" title="Instagram" target="_blank">Instagram</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Blog of DC.</a><!--|  Powered by--><!--a(rel='nofollow', target='_blank', href='https://hexo.io')  Hexo.--><!--a(rel='nofollow', target='_blank', href='https://github.com/tufu9441/maupassant-hexo')  Theme--><!--|  by--><!--a(rel='nofollow', target='_blank', href='https://github.com/pagecho')  Cho.--></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>